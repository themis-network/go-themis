package core

import (
	"math/big"
	"strings"

	"github.com/themis-network/go-themis/accounts/abi"
	"github.com/themis-network/go-themis/common"
	"github.com/themis-network/go-themis/core/types"
	"github.com/themis-network/go-themis/log"
	"github.com/themis-network/go-themis/params"
)

const (
	// Deployed code of system contract
	mainSystemContractCode = "0x6080604052600436106101cc5763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416630481c75f81146101d157806304f49a3a146101f8578063081918741461022c5780630e14a376146102cd57806313bc6d4b146102f957806321f8a7211461031a5780632c62ff2d146103325780632e28d0841461034a57806335f7ff63146103a857806336cb6592146104355780633b7bfda0146104505780633e49bed0146104685780633f185b6c146104835780634a3270d7146104a45780634b9f5c98146104bc5780635948f733146104d65780635beff9931461053e578063616b59f6146105565780636e8995501461056e578063789c617c146105cc57806379e41595146105e45780637ae1cfca1461063d5780638c16009514610655578063986e791a1461066d578063a855d4ce14610685578063abfdcced1461069d578063b9e2bea0146106ba578063bd02d0f5146107d6578063c031a180146107ee578063ca446dd914610806578063dc97d9621461082a578063ddf8016614610842578063e2a4853a14610863578063e2b202bf1461087e578063e80a7eb914610896578063ec672cf6146108ab578063f6bb3cc414610905575b600080fd5b3480156101dd57600080fd5b506101e661091d565b60408051918252519081900360200190f35b34801561020457600080fd5b50610210600435610924565b60408051600160a060020a039092168252519081900360200190f35b34801561023857600080fd5b50604080516020600480358082013583810280860185019096528085526102cb95369593946024949385019291829185019084908082843750506040805187358901803560208181028481018201909552818452989b9a99890198929750908201955093508392508501908490808284375094975050508335600160a060020a031694505050506020013560ff1661093f565b005b3480156102d957600080fd5b506102e5600435610d60565b604080519115158252519081900360200190f35b34801561030557600080fd5b506102e5600160a060020a0360043516610dca565b34801561032657600080fd5b50610210600435610e13565b34801561033e57600080fd5b506102e5600435610e2e565b34801561035657600080fd5b5060408051602060046024803582810135601f81018590048502860185019096528585526102e5958335953695604494919390910191908190840183828082843750949750610e929650505050505050565b3480156103b457600080fd5b506103c0600435610f03565b6040805160208082528351818301528351919283929083019185019080838360005b838110156103fa5781810151838201526020016103e2565b50505050905090810190601f1680156104275780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561044157600080fd5b50610210600435602435610f9e565b34801561045c57600080fd5b506102e5600435610fd5565b34801561047457600080fd5b506102e5600435602435610fea565b34801561048f57600080fd5b506102e5600160a060020a0360043516611048565b3480156104b057600080fd5b506103c060043561109f565b3480156104c857600080fd5b506102cb6004351515611107565b3480156104e257600080fd5b506104ee600435611309565b60408051602080825283518183015283519192839290830191858101910280838360005b8381101561052a578181015183820152602001610512565b505050509050019250505060405180910390f35b34801561054a57600080fd5b506102e5600435611375565b34801561056257600080fd5b506102e56004356113dc565b34801561057a57600080fd5b5060408051602060046024803582810135601f81018590048502860185019096528585526102e595833595369560449491939091019190819084018382808284375094975061143b9650505050505050565b3480156105d857600080fd5b506101e66004356114a2565b3480156105f057600080fd5b506040805160206004803580820135601f81018490048402850184019095528484526102109436949293602493928401919081908401838280828437509497506114b49650505050505050565b34801561064957600080fd5b506102e5600435611533565b34801561066157600080fd5b506102e5600435611548565b34801561067957600080fd5b506103c06004356115a5565b34801561069157600080fd5b506101e660043561163c565b3480156106a957600080fd5b506102e5600435602435151561164e565b3480156106c657600080fd5b506106cf6116ba565b604051808b81526020018a15151515815260200189600160a060020a0316600160a060020a0316815260200188815260200187600160a060020a0316600160a060020a03168152602001806020018060200186600381111561072d57fe5b60ff168152602001858152602001848152602001838103835288818151815260200191508051906020019060200280838360005b83811015610779578181015183820152602001610761565b50505050905001838103825287818151815260200191508051906020019060200280838360005b838110156107b85781810151838201526020016107a0565b505050509050019c5050505050505050505050505060405180910390f35b3480156107e257600080fd5b506101e66004356117d0565b3480156107fa57600080fd5b506103c06004356117e2565b34801561081257600080fd5b506102e5600435600160a060020a036024351661184c565b34801561083657600080fd5b506101e66004356118c6565b34801561084e57600080fd5b506102e5600160a060020a03600435166118d8565b34801561086f57600080fd5b506102e5600435602435611a0f565b34801561088a57600080fd5b506102e5600435611a6d565b3480156108a257600080fd5b506104ee611aca565b3480156108b757600080fd5b506040805160206004602480358281013584810280870186019097528086526102e596843596369660449591949091019291829185019084908082843750949750611b2c9650505050505050565b34801561091157600080fd5b506102e5600435611b93565b6011545b90565b600060208190529081526040902054600160a060020a031681565b6000808083600181600381111561095257fe5b14806109695750600281600381111561096757fe5b145b8061097f5750600381600381111561097d57fe5b145b151561098a57600080fd5b604080516000805160206125278339815191528152606060020a3302600f82015281519081900360230190206000908152600260205220546001146109ce57600080fd5b604080517f73797374656d2e70726f706f73616c506572696f64000000000000000000000081528151908190036015019020600090815260026020522054600954909450610a22908563ffffffff611bf216565b421180610a32575060085460ff16155b1515610a3d57600080fd5b6003856003811115610a4b57fe5b14610a6c578651885114610a5e57600080fd5b8751601e11610a6c57600080fd5b6003856003811115610a7a57fe5b1415610af257600160a060020a0386161515610a9557600080fd5b604080516000805160206125278339815191528152606060020a600160a060020a03891602600f820152815190819003602301902060009081526002602052205492506001831480610ae75750826002145b1515610af257600080fd5b60088054426009556001600e8190556000600f556012805482019081905560075574ffffffffffffffffffffffffffffffffffffffff001990911633610100021760ff19161790558751610b4d90600b9060208b0190612304565b508651610b6190600c9060208a0190612351565b50600d805486919060ff19166001836003811115610b7b57fe5b0217905550600a8054600160a060020a031916600160a060020a0388161790556003856003811115610ba957fe5b1415610c6d57600a805460408051600080516020612527833981519152808252606060020a600160a060020a039485168102600f808501829052855194859003602390810186206000818152600260208181528a8320547f70726f64756365722e6f726953746174757300000000000000000000000000008b5260128b01979097528a51998a90036026018a2083528181528a8320969096559a54968852959098169093029085015284519384900390910190922081529390529091206003905591505b337f3d43a162b09d7897a972eadab0eebbcbbc97a2e39bde4e55a8c4f9a56a0e742a898989896003811115610c9e57fe5b60405180806020018060200185600160a060020a0316600160a060020a03168152602001848152602001838103835287818151815260200191508051906020019060200280838360005b83811015610d00578181015183820152602001610ce8565b50505050905001838103825286818151815260200191508051906020019060200280838360005b83811015610d3f578181015183820152602001610d27565b50505050905001965050505050505060405180910390a25050505050505050565b604080516000805160206125478339815191528152606060020a3302600e8201528151908190036022019020600090815260056020529081205460ff161515610da857600080fd5b5060009081526020819052604090208054600160a060020a0319169055600190565b604080516000805160206125478339815191528152606060020a600160a060020a03841602600e820152815190819003602201902060009081526005602052205460ff16919050565b600090815260208190526040902054600160a060020a031690565b604080516000805160206125478339815191528152606060020a3302600e8201528151908190036022019020600090815260056020529081205460ff161515610e7657600080fd5b506000908152600560205260409020805460ff19169055600190565b604080516000805160206125478339815191528152606060020a3302600e8201528151908190036022019020600090815260056020529081205460ff161515610eda57600080fd5b60008381526004602090815260409091208351610ef99285019061238c565b5060019392505050565b60036020908152600091825260409182902080548351601f600260001961010060018616150201909316929092049182018490048402810184019094528084529091830182828015610f965780601f10610f6b57610100808354040283529160200191610f96565b820191906000526020600020905b815481529060010190602001808311610f7957829003601f168201915b505050505081565b600160205281600052604060002081815481101515610fb957fe5b600091825260209091200154600160a060020a03169150829050565b60056020526000908152604090205460ff1681565b604080516000805160206125478339815191528152606060020a3302600e8201528151908190036022019020600090815260056020529081205460ff16151561103257600080fd5b5060009182526006602052604090912055600190565b604080516000805160206125478339815191528152606060020a3302600e8201528151908190036022019020600090815260056020529081205460ff16151561109057600080fd5b61109982611bff565b92915050565b60046020908152600091825260409182902080548351601f600260001961010060018616150201909316929092049182018490048402810184019094528084529091830182828015610f965780601f10610f6b57610100808354040283529160200191610f96565b604080516000805160206125278339815191528152606060020a3302600f82015281519081900360230190206000908152600260205290812054819060011461114f57600080fd5b6008546101009004600160a060020a031633141561116c57600080fd5b600754600090815260106020908152604080832033845290915290205460ff161561119657600080fd5b60075460009081526010602090815260408083203384529091529020805460ff19166001179055821561121357600e80546001019055601154600390600202046001019150816007800154101580156111f6575060085460ff1615156001145b1561120e57611203611daf565b6008805460ff191690555b6112c5565b50600f805460010190819055601154600390049081116112c5576008805460ff19169055600a54604080517f70726f64756365722e6f726953746174757300000000000000000000000000008152606060020a600160a060020a0390931692909202601283018190528151928390036026018320600090815260026020818152848320546000805160206125278339815191528752600f87019490945284519586900360230190952082529093529120555b600754604080519182528415156020830152805133927ff57141aca9c9f5c6be4736dba435bfedbeadb80081e357742755ef36722b14ba92908290030190a2505050565b60008181526001602090815260409182902080548351818402810184019094528084526060939283018282801561136957602002820191906000526020600020905b8154600160a060020a0316815260019091019060200180831161134b575b50505050509050919050565b604080516000805160206125478339815191528152606060020a3302600e8201528151908190036022019020600090815260056020529081205460ff1615156113bd57600080fd5b60008281526001602052604081206113d4916123f9565b506001919050565b604080516000805160206125478339815191528152606060020a3302600e8201528151908190036022019020600090815260056020529081205460ff16151561142457600080fd5b60008281526004602052604081206113d49161241a565b604080516000805160206125478339815191528152606060020a3302600e8201528151908190036022019020600090815260056020529081205460ff16151561148357600080fd5b60008381526003602090815260409091208351610ef99285019061238c565b60066020526000908152604090205481565b6000806000836040518082805190602001908083835b602083106114e95780518252601f1990920191602091820191016114ca565b51815160209384036101000a6000190180199092169116179052604080519290940182900390912086528501959095529290920160002054600160a060020a031695945050505050565b60009081526005602052604090205460ff1690565b604080516000805160206125478339815191528152606060020a3302600e8201528151908190036022019020600090815260056020529081205460ff16151561159057600080fd5b50600090815260066020526040812055600190565b60008181526003602090815260409182902080548351601f60026101006001851615026000190190931692909204918201849004840281018401909452808452606093928301828280156113695780601f1061160f57610100808354040283529160200191611369565b820191906000526020600020905b81548152906001019060200180831161161d5750939695505050505050565b60026020526000908152604090205481565b604080516000805160206125478339815191528152606060020a3302600e8201528151908190036022019020600090815260056020529081205460ff16151561169657600080fd5b50600091825260056020526040909120805460ff1916911515919091179055600190565b600754600854600954600a54600d54600e54600f54600b80546040805160208084028201810190925282815260009a8b9a8b9a8b9a8b9a60609a8b9a8d9a8b9a8b9a989960ff808a169a610100909a04600160a060020a039081169a9816979396600c9691169490939092879183018282801561175757602002820191906000526020600020905b81548152600190910190602001808311611742575b50505050509450838054806020026020016040519081016040528092919081815260200182805480156117a957602002820191906000526020600020905b815481526020019060010190808311611795575b50505050509350995099509950995099509950995099509950995090919293949596979899565b60009081526002602052604090205490565b60008181526004602090815260409182902080548351601f60026101006001851615026000190190931692909204918201849004840281018401909452808452606093928301828280156113695780601f1061160f57610100808354040283529160200191611369565b604080516000805160206125478339815191528152606060020a3302600e8201528151908190036022019020600090815260056020529081205460ff16151561189457600080fd5b5060008281526020819052604090208054600160a060020a038316600160a060020a0319909116179055600192915050565b60009081526006602052604090205490565b604080516000805160206125478339815191528152606060020a3302600e8201528151908190036022019020600090815260056020529081205460ff16151561192057600080fd5b604080517f73797374656d2e6d617850726f647563657253697a6500000000000000000000815281519081900360160190206000908152600260205220546011541061196b57600080fd5b5060118054604080517f70726f64756365722e696e6465780000000000000000000000000000000000008152606060020a600160a060020a038616908102600e8301528251918290036022019091206000908152600260205291822083905560018084018555939091527f31ecc21a745e3968a04e9570e4425bc18fa8019c68028196b546d1669c200c689091018054600160a060020a0319169091179055919050565b604080516000805160206125478339815191528152606060020a3302600e8201528151908190036022019020600090815260056020529081205460ff161515611a5757600080fd5b5060009182526002602052604090912055600190565b604080516000805160206125478339815191528152606060020a3302600e8201528151908190036022019020600090815260056020529081205460ff161515611ab557600080fd5b50600090815260026020526040812055600190565b60606011805480602002602001604051908101604052809291908181526020018280548015611b2257602002820191906000526020600020905b8154600160a060020a03168152600190910190602001808311611b04575b5050505050905090565b604080516000805160206125478339815191528152606060020a3302600e8201528151908190036022019020600090815260056020529081205460ff161515611b7457600080fd5b60008381526001602090815260409091208351610ef99285019061245e565b604080516000805160206125478339815191528152606060020a3302600e8201528151908190036022019020600090815260056020529081205460ff161515611bdb57600080fd5b60008281526003602052604081206113d49161241a565b8181018281101561109957fe5b601154600090819081908110611c1457600080fd5b5050604080517f70726f64756365722e696e6465780000000000000000000000000000000000008152606060020a600160a060020a03851602600e82015281519081900360220190206000908152600260205290812054601154909160001991909101908210801590611c88575060115482105b1515611c9357600080fd5b80821415611cb15780611ca76011826124bf565b5060019250611da8565b6011805482908110611cbf57fe5b60009182526020909120015460118054600160a060020a039092169184908110611ce557fe5b9060005260206000200160006101000a815481600160a060020a030219169083600160a060020a031602179055508160026000601184815481101515611d2757fe5b6000918252602080832090910154604080517f70726f64756365722e696e6465780000000000000000000000000000000000008152606060020a600160a060020a0390931692909202600e83015280519182900360220190912084529083019390935291019020556011805490611da29060001983016124bf565b50600192505b5050919050565b6000808080806001600d5460ff166003811115611dc857fe5b1415612046575b600b54851015611fc857600b8054600091829188908110611dec57fe5b6000918252602080832090910154835282810193909352604091820181205482516000805160206125478339815191528152606060020a600160a060020a03909216918202600e82015283519081900360220190208252600590935220805460ff19169055600c80549195509086908110611e6357fe5b6000918252602090912001549250600160a060020a0383161515611e8657611fbd565b600160a060020a03841615611f225783600160a060020a0316639be6d404846040518263ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018082600160a060020a0316600160a060020a03168152602001915050600060405180830381600087803b158015611f0957600080fd5b505af1158015611f1d573d6000803e3d6000fd5b505050505b604080516000805160206125478339815191528152606060020a600160a060020a03861602600e820152815190819003602201902060009081526005602052908120805460ff19166001179055600b8054859291829189908110611f8257fe5b600091825260208083209190910154835282019290925260400190208054600160a060020a031916600160a060020a03929092169190911790555b600190940193611dcf565b7fc71c9baf50bdeb6e875f0da1b066a334d9c66ed4eda821789e577b10e363b85960076005016040518080602001828103825283818154815260200191508054801561203357602002820191906000526020600020905b81548152602001906001019080831161201f575b50509250505060405180910390a16122fd565b6002600d5460ff16600381111561205957fe5b141561214057600094505b600b548510156120c457600c80548690811061207c57fe5b90600052602060002001546002600060076004018881548110151561209d57fe5b60009182526020808320909101548352820192909252604001902055600190940193612064565b7f9ccdd23b1391fc2fab1e95b0e1efbd4e7b48867ed3eba180bbc99c900a154a16600760050160405180806020018281038252838181548152602001915080548015612033576020028201919060005260206000209081548152602001906001019080831161201f5750509250505060405180910390a16122fd565b6003600d5460ff16600381111561215357fe5b14156101cc57600a54604080516000805160206125278339815191528152606060020a600160a060020a0390931692909202600f830152805191829003602301909120600090815260026020522054915060018214156121d057600a546121c290600160a060020a0316611bff565b15156001146121d057600080fd5b50600a8054604080516000805160206125278339815191528152606060020a600160a060020a039384168102600f8301528251918290036023018220600090815260026020818152858320600490557f70726f64756365722e6d616c6963696f75734465706f736974000000000000008552855194859003601901852097547f70726f64756365722e6465706f73697400000000000000000000000000000000865290961690920260108401528351928390036024019092208252909252808220548383529120546122a79163ffffffff611bf216565b60008281526002602090815260409182902092909255600a548151600160a060020a03909116815290517f6c763b676b89e671fcb99873c673cff315a419f55e294559ff31b2383095ee39929181900390910190a15b5050505050565b828054828255906000526020600020908101928215612341579160200282015b828111156123415782518255602090920191600190910190612324565b5061234d9291506124e8565b5090565b828054828255906000526020600020908101928215612341579160200282015b82811115612341578251825591602001919060010190612371565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106123cd57805160ff1916838001178555612341565b828001600101855582156123415791820182811115612341578251825591602001919060010190612371565b508054600082559060005260206000209081019061241791906124e8565b50565b50805460018160011615610100020316600290046000825580601f106124405750612417565b601f01602090049060005260206000209081019061241791906124e8565b8280548282559060005260206000209081019282156124b3579160200282015b828111156124b35782518254600160a060020a031916600160a060020a0390911617825560209092019160019091019061247e565b5061234d929150612502565b8154818355818111156124e3576000838152602090206124e39181019083016124e8565b505050565b61092191905b8082111561234d57600081556001016124ee565b61092191905b8082111561234d578054600160a060020a0319168155600101612508560070726f64756365722e737461747573000000000000000000000000000000000073797374656d2e61646472657373000000000000000000000000000000000000a165627a7a72305820069ca01f31db7d6574abfef74554eb2c49e35d8fc436923ab79a95c3afe313480029"
	regSystemContractCode  = "0x6080604052600436106100ab5763ffffffff60e060020a60003504166304be495a81146100b05780630d2fe9da146100d9578063117df0881461010a5780631af5507314610121578063421fca72146101d65780639be6d4041461020e578063a30f24c41461022f578063aab147b214610244578063ab91ae8014610277578063c792d3591461028c578063d385c02f146102a1578063e53966b7146102b6578063e80a7eb9146102e1575b600080fd5b3480156100bc57600080fd5b506100c5610346565b604080519115158252519081900360200190f35b3480156100e557600080fd5b506100ee61064e565b60408051600160a060020a039092168252519081900360200190f35b34801561011657600080fd5b5061011f61065d565b005b34801561012d57600080fd5b50610136610f46565b604051808060200180602001848152602001838103835286818151815260200191508051906020019060200280838360005b83811015610180578181015183820152602001610168565b50505050905001838103825285818151815260200191508051906020019060200280838360005b838110156101bf5781810151838201526020016101a7565b505050509050019550505050505060405180910390f35b3480156101e257600080fd5b506100c56024600480358281019290820135918135808301929082013591604435918201910135611256565b34801561021a57600080fd5b5061011f600160a060020a03600435166116d9565b34801561023b57600080fd5b506100c56116fc565b34801561025057600080fd5b50610265600160a060020a0360043516611940565b60408051918252519081900360200190f35b34801561028357600080fd5b506100ee6119ee565b34801561029857600080fd5b506102656119fd565b3480156102ad57600080fd5b506100c5611a06565b6100c56024600480358281019290820135918135808301929082013591604435918201910135612133565b3480156102ed57600080fd5b506102f6612a26565b60408051602080825283518183015283519192839290830191858101910280838360005b8381101561033257818101518382015260200161031a565b505050509050019250505060405180910390f35b6000805460408051600080516020612b708339815191528152606060020a33026009820152815190819003601d01812060e060020a63bd02d0f502825260048201529051600160a060020a039092169163bd02d0f59160248082019260209290919082900301818787803b1580156103bd57600080fd5b505af11580156103d1573d6000803e3d6000fd5b505050506040513d60208110156103e757600080fd5b50516002146103f557600080fd5b60008054604080517f766f74652e7374617475730000000000000000000000000000000000000000008152606060020a3302600b820152815190819003601f01812060e060020a63bd02d0f502825260048201529051600160a060020a039092169263bd02d0f5926024808401936020939083900390910190829087803b15801561047f57600080fd5b505af1158015610493573d6000803e3d6000fd5b505050506040513d60208110156104a957600080fd5b5051600114156104b857600080fd5b6000805460408051600080516020612b708339815191528152606060020a33026009820152815190819003601d01812060e060020a63e2b202bf02825260048201529051600160a060020a039092169263e2b202bf926024808401936020939083900390910190829087803b15801561053057600080fd5b505af1158015610544573d6000803e3d6000fd5b505050506040513d602081101561055a57600080fd5b505060008054604080517f766f74652e7374617475730000000000000000000000000000000000000000008152606060020a3302600b820152815190819003601f01812060e060020a63e2b202bf02825260048201529051600160a060020a039092169263e2b202bf926024808401936020939083900390910190829087803b1580156105e657600080fd5b505af11580156105fa573d6000803e3d6000fd5b505050506040513d602081101561061057600080fd5b505060408051428152905133917fc7ccee8c463e1c633c3c5e935f474bf6574a54a4b7857c9aa57b4e40f855f259919081900360200190a250600190565b600154600160a060020a031681565b60408051600080516020612b508339815191528152606060020a3302600f82015281519081900360230181206000805460e060020a63bd02d0f5028452600484018390529351919390928392839283928392600160a060020a03929092169163bd02d0f59160248082019260209290919082900301818787803b1580156106e357600080fd5b505af11580156106f7573d6000803e3d6000fd5b505050506040513d602081101561070d57600080fd5b505160021461071b57600080fd5b60008054604080517f73797374656d2e6c6f636b54696d65466f724465706f736974000000000000008152815190819003601901812060e060020a63bd02d0f502825260048201529051600160a060020a039092169263bd02d0f5926024808401936020939083900390910190829087803b15801561079957600080fd5b505af11580156107ad573d6000803e3d6000fd5b505050506040513d60208110156107c357600080fd5b505160008054604080517f70726f64756365722e6f757454696d6500000000000000000000000000000000815233606060020a02601082015281516024918190038201812060e060020a63bd02d0f50282526004820152915194995061088e948a94600160a060020a039094169363bd02d0f5938381019360209392918390030190829087803b15801561085657600080fd5b505af115801561086a573d6000803e3d6000fd5b505050506040513d602081101561088057600080fd5b50519063ffffffff612b1516565b421161089957600080fd5b6000805460408051600080516020612b708339815191528152606060020a33026009820152815190819003601d01812060e060020a63e2b202bf02825260048201529051600160a060020a039092169263e2b202bf926024808401936020939083900390910190829087803b15801561091157600080fd5b505af1158015610925573d6000803e3d6000fd5b505050506040513d602081101561093b57600080fd5b505060008054604080517f70726f64756365722e6e616d65000000000000000000000000000000000000008152606060020a3302600d82015281519081900360210181207ff6bb3cc400000000000000000000000000000000000000000000000000000000825260048201529051600160a060020a039092169263f6bb3cc4926024808401936020939083900390910190829087803b1580156109dd57600080fd5b505af11580156109f1573d6000803e3d6000fd5b505050506040513d6020811015610a0757600080fd5b505060008054604080517f70726f64756365722e77656255726c00000000000000000000000000000000008152606060020a3302600f82015281519081900360230181207ff6bb3cc400000000000000000000000000000000000000000000000000000000825260048201529051600160a060020a039092169263f6bb3cc4926024808401936020939083900390910190829087803b158015610aa957600080fd5b505af1158015610abd573d6000803e3d6000fd5b505050506040513d6020811015610ad357600080fd5b505060008054604080517f70726f64756365722e70327055726c00000000000000000000000000000000008152606060020a3302600f82015281519081900360230181207ff6bb3cc400000000000000000000000000000000000000000000000000000000825260048201529051600160a060020a039092169263f6bb3cc4926024808401936020939083900390910190829087803b158015610b7557600080fd5b505af1158015610b89573d6000803e3d6000fd5b505050506040513d6020811015610b9f57600080fd5b5050600080546040805160e060020a63e2b202bf028152600481018a90529051600160a060020a039092169263e2b202bf926024808401936020939083900390910190829087803b158015610bf357600080fd5b505af1158015610c07573d6000803e3d6000fd5b505050506040513d6020811015610c1d57600080fd5b5050604080517f70726f64756365722e6465706f736974000000000000000000000000000000008152606060020a330260108201819052825191829003602490810183207f70726f64756365722e72657761726473466f72566f74696e674f75744261644284527f5000000000000000000000000000000000000000000000000000000000000000602085810191909152602185019390935284519384900360350184206000805460e060020a63bd02d0f5028752600487018490529651929a50909850600160a060020a03959095169463bd02d0f5948084019493908390030190829087803b158015610d1057600080fd5b505af1158015610d24573d6000803e3d6000fd5b505050506040513d6020811015610d3a57600080fd5b5051600080546040805160e060020a63bd02d0f5028152600481018890529051939550600160a060020a039091169263bd02d0f592602480840193602093929083900390910190829087803b158015610d9257600080fd5b505af1158015610da6573d6000803e3d6000fd5b505050506040513d6020811015610dbc57600080fd5b5051600080546040805160e060020a63e2b202bf028152600481018990529051939450600160a060020a039091169263e2b202bf92602480840193602093929083900390910190829087803b158015610e1457600080fd5b505af1158015610e28573d6000803e3d6000fd5b505050506040513d6020811015610e3e57600080fd5b5050600080546040805160e060020a63e2b202bf028152600481018790529051600160a060020a039092169263e2b202bf926024808401936020939083900390910190829087803b158015610e9257600080fd5b505af1158015610ea6573d6000803e3d6000fd5b505050506040513d6020811015610ebc57600080fd5b503390506108fc610ed3848463ffffffff612b1516565b6040518115909202916000818181858888f19350505050158015610efb573d6000803e3d6000fd5b5060408051838152602081018390524281830152905133917f7fd459aa2b64c5caf30ef8d21246cb3ab56d43757f68285ccb6ff6dc9f4e515c919081900360600190a2505050505050565b60608060006060806000600160009054906101000a9004600160a060020a0316600160a060020a031663e80a7eb96040518163ffffffff1660e060020a028152600401600060405180830381600087803b158015610fa357600080fd5b505af1158015610fb7573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f191682016040526020811015610fe057600080fd5b810190808051640100000000811115610ff857600080fd5b8201602081018481111561100b57600080fd5b815185602082028301116401000000008211171561102857600080fd5b50509291905050509250825160405190808252806020026020018201604052801561105d578160200160208202803883390190505b509150600090505b825181101561119c57825160009084908390811061107f57fe5b60209081029091010151600160a060020a031614611179576000548351600160a060020a039091169063bd02d0f5908590849081106110ba57fe5b602090810290910181015160408051600080516020612b908339815191528152606060020a600160a060020a03909316929092026013830152805191829003602701822060e060020a63ffffffff8616028352600483015251602480830193928290030181600087803b15801561113057600080fd5b505af1158015611144573d6000803e3d6000fd5b505050506040513d602081101561115a57600080fd5b5051825183908390811061116a57fe5b60209081029091010152611194565b6000828281518110151561118957fe5b602090810290910101525b600101611065565b60008054604080517f73797374656d2e70726f647563657253697a65000000000000000000000000008152815190819003601301812060e060020a63bd02d0f50282526004820152905186938693600160a060020a03169263bd02d0f59260248083019360209383900390910190829087803b15801561121b57600080fd5b505af115801561122f573d6000803e3d6000fd5b505050506040513d602081101561124557600080fd5b505191975095509350505050909192565b6000805460408051600080516020612b708339815191528152606060020a33026009820152815190819003601d01812060e060020a63bd02d0f502825260048201529051600160a060020a039092169163bd02d0f59160248082019260209290919082900301818787803b1580156112cd57600080fd5b505af11580156112e1573d6000803e3d6000fd5b505050506040513d60208110156112f757600080fd5b505160011461130557600080fd5b6000805460408051600080516020612b508339815191528152606060020a3302600f820152815190819003602301812060e060020a63bd02d0f502825260048201529051600160a060020a039092169263bd02d0f5926024808401936020939083900390910190829087803b15801561137d57600080fd5b505af1158015611391573d6000803e3d6000fd5b505050506040513d60208110156113a757600080fd5b50516001146113b557600080fd5b600054604080517f70726f64756365722e6e616d65000000000000000000000000000000000000008152606060020a3302600d820152815190819003602101812060e460020a6306e899550282526004820181815260248301938452604483018b9052600160a060020a0390941693636e8995509391928c928c92916064018484808284378201915050945050505050602060405180830381600087803b15801561145f57600080fd5b505af1158015611473573d6000803e3d6000fd5b505050506040513d602081101561148957600080fd5b5050600054604080517f70726f64756365722e77656255726c00000000000000000000000000000000008152606060020a3302600f820152815190819003602301812060e460020a6306e89955028252600482018181526024830193845260448301899052600160a060020a0390941693636e8995509391928a928a92916064018484808284378201915050945050505050602060405180830381600087803b15801561153557600080fd5b505af1158015611549573d6000803e3d6000fd5b505050506040513d602081101561155f57600080fd5b5050600054604080517f70726f64756365722e70327055726c00000000000000000000000000000000008152606060020a3302600f820152815190819003602301812060e460020a6306e89955028252600482018181526024830193845260448301879052600160a060020a0390941693636e89955093919288928892916064018484808284378201915050945050505050602060405180830381600087803b15801561160b57600080fd5b505af115801561161f573d6000803e3d6000fd5b505050506040513d602081101561163557600080fd5b5050604080516060808252810188905233917ff803dd90f36c9991471017caaf6c9b7c7fc074fae88b065bb25a307214999988918a918a918a918a918a918a9190819060208201908201608083018a8a80828437909101858103845288815260200190508888808284379091018581038352868152602001905086868082843760405192018290039b50909950505050505050505050a25060019695505050505050565b600054600160a060020a031633146116f057600080fd5b80600160a060020a0316ff5b6000805460408051600080516020612b708339815191528152606060020a33026009820152815190819003601d01812060e060020a63bd02d0f502825260048201529051600160a060020a039092169163bd02d0f59160248082019260209290919082900301818787803b15801561177357600080fd5b505af1158015611787573d6000803e3d6000fd5b505050506040513d602081101561179d57600080fd5b5051156117a957600080fd5b6000805460408051600080516020612b708339815191528152606060020a33026009820152815190819003601d01812060e160020a637152429d0282526004820152600260248201529051600160a060020a039092169263e2a4853a926044808401936020939083900390910190829087803b15801561182857600080fd5b505af115801561183c573d6000803e3d6000fd5b505050506040513d602081101561185257600080fd5b505060008054604080517f70726f78792e7374617475730000000000000000000000000000000000000000815233606060020a02600c82015281516020918190038201812060e160020a637152429d0282526004820152600160248201529151600160a060020a039093169363e2a4853a936044808501949192918390030190829087803b1580156118e357600080fd5b505af11580156118f7573d6000803e3d6000fd5b505050506040513d602081101561190d57600080fd5b505060405133907fc686b241606f36270db6f798cbe0c01c064676c4918449e684002f91af8d560c90600090a250600190565b6000805460408051600080516020612b908339815191528152606060020a600160a060020a03868116919091026013830152825191829003602701822060e060020a63bd02d0f502835260048301529151919092169163bd02d0f591602480830192602092919082900301818787803b1580156119bc57600080fd5b505af11580156119d0573d6000803e3d6000fd5b505050506040513d60208110156119e657600080fd5b505192915050565b600054600160a060020a031681565b6407915e5b8081565b6000805460408051600080516020612b708339815191528152606060020a33026009820152815190819003601d01812060e060020a63bd02d0f5028252600482015290518392839283928392600160a060020a03169163bd02d0f591602480830192602092919082900301818787803b158015611a8257600080fd5b505af1158015611a96573d6000803e3d6000fd5b505050506040513d6020811015611aac57600080fd5b5051600114611aba57600080fd5b6000805460408051600080516020612b508339815191528152606060020a3302600f820152815190819003602301812060e060020a63bd02d0f502825260048201529051600160a060020a039092169263bd02d0f5926024808401936020939083900390910190829087803b158015611b3257600080fd5b505af1158015611b46573d6000803e3d6000fd5b505050506040513d6020811015611b5c57600080fd5b5051600114611b6a57600080fd5b6000805460408051600080516020612b908339815191528152606060020a33026013820152815190819003602701812060e060020a63e2b202bf02825260048201529051600160a060020a039092169263e2b202bf926024808401936020939083900390910190829087803b158015611be257600080fd5b505af1158015611bf6573d6000803e3d6000fd5b505050506040513d6020811015611c0c57600080fd5b50506000805460408051600080516020612b508339815191528152606060020a3302600f820152815190819003602301812060e160020a637152429d0282526004820152600260248201529051600160a060020a039092169263e2a4853a926044808401936020939083900390910190829087803b158015611c8d57600080fd5b505af1158015611ca1573d6000803e3d6000fd5b505050506040513d6020811015611cb757600080fd5b505060008054604080517f70726f64756365722e6f757454696d65000000000000000000000000000000008152606060020a330260108201528151908190036024908101822060e160020a637152429d028352600483015242908201529051600160a060020a039092169263e2a4853a926044808401936020939083900390910190829087803b158015611d4a57600080fd5b505af1158015611d5e573d6000803e3d6000fd5b505050506040513d6020811015611d7457600080fd5b5050604080517f70726f64756365722e6d616c6963696f75734465706f73697400000000000000815281519081900360190181206000805460e060020a63bd02d0f5028452600484018390529351919750600160a060020a039093169263bd02d0f592602480820193602093909283900390910190829087803b158015611dfa57600080fd5b505af1158015611e0e573d6000803e3d6000fd5b505050506040513d6020811015611e2457600080fd5b5051600154604080517f0481c75f0000000000000000000000000000000000000000000000000000000081529051929550600160a060020a0390911691630481c75f916004808201926020929091908290030181600087803b158015611e8957600080fd5b505af1158015611e9d573d6000803e3d6000fd5b505050506040513d6020811015611eb357600080fd5b50519150611ec7838363ffffffff612b2816565b600054909150600160a060020a031663e2a4853a85611eec868563ffffffff612b3d16565b6040518363ffffffff1660e060020a02815260040180836000191660001916815260200182815260200192505050602060405180830381600087803b158015611f3457600080fd5b505af1158015611f48573d6000803e3d6000fd5b505050506040513d6020811015611f5e57600080fd5b505060008054604080517f70726f64756365722e72657761726473466f72566f74696e674f75744261644281527f5000000000000000000000000000000000000000000000000000000000000000602082810191909152606060020a33026021830152825191829003603501822060e160020a637152429d0283526004830152602482018690529151600160a060020a039093169363e2a4853a93604480840194939192918390030190829087803b15801561201957600080fd5b505af115801561202d573d6000803e3d6000fd5b505050506040513d602081101561204357600080fd5b5050600154604080517f3f185b6c0000000000000000000000000000000000000000000000000000000081523360048201529051600160a060020a0390921691633f185b6c916024808201926020929091908290030181600087803b1580156120ab57600080fd5b505af11580156120bf573d6000803e3d6000fd5b505050506040513d60208110156120d557600080fd5b505115156001146120e557600080fd5b6040805142815260208101859052808201849052905133917f2949f263f458927225aa89a823ee4b005c563a54d664a27923a2221c9c07d6b4919081900360600190a2600194505050505090565b6000805460408051600080516020612b708339815191528152606060020a339081026009830152825191829003601d01822060e060020a63bd02d0f50283526004830152915191928492600160a060020a039091169163bd02d0f591602480830192602092919082900301818787803b1580156121af57600080fd5b505af11580156121c3573d6000803e3d6000fd5b505050506040513d60208110156121d957600080fd5b5051156121e557600080fd5b60008054604080517f73797374656d2e6465706f736974466f7250726f6475636572000000000000008152815190819003601901812060e060020a63bd02d0f502825260048201529051600160a060020a039092169263bd02d0f5926024808401936020939083900390910190829087803b15801561226357600080fd5b505af1158015612277573d6000803e3d6000fd5b505050506040513d602081101561228d57600080fd5b505190503481111561229e57600080fd5b6000805460408051600080516020612b708339815191528152606060020a600160a060020a03878116919091026009830152825191829003601d01822060e160020a637152429d0283526004830152600160248301529151919092169263e2a4853a92604480820193602093909283900390910190829087803b15801561232457600080fd5b505af1158015612338573d6000803e3d6000fd5b505050506040513d602081101561234e57600080fd5b5050600054604080517f70726f64756365722e6e616d65000000000000000000000000000000000000008152606060020a600160a060020a0386811691909102600d830152825191829003602101822060e460020a6306e899550283526004830181815260248401948552604484018e90529190941693636e8995509390928e928e9290916064018484808284378201915050945050505050602060405180830381600087803b15801561240157600080fd5b505af1158015612415573d6000803e3d6000fd5b505050506040513d602081101561242b57600080fd5b5050600054604080517f70726f64756365722e77656255726c00000000000000000000000000000000008152606060020a600160a060020a0386811691909102600f830152825191829003602301822060e460020a6306e899550283526004830181815260248401948552604484018c90529190941693636e8995509390928c928c9290916064018484808284378201915050945050505050602060405180830381600087803b1580156124de57600080fd5b505af11580156124f2573d6000803e3d6000fd5b505050506040513d602081101561250857600080fd5b5050600054604080517f70726f64756365722e70327055726c00000000000000000000000000000000008152606060020a600160a060020a0386811691909102600f830152825191829003602301822060e460020a6306e899550283526004830181815260248401948552604484018a90529190941693636e8995509390928a928a9290916064018484808284378201915050945050505050602060405180830381600087803b1580156125bb57600080fd5b505af11580156125cf573d6000803e3d6000fd5b505050506040513d60208110156125e557600080fd5b505060008054604080517f70726f64756365722e6465706f736974000000000000000000000000000000008152600160a060020a03868116606060020a02601083015282516024928190038301812060e160020a637152429d028252600482015234928101929092529151919092169263e2a4853a92604480820193602093909283900390910190829087803b15801561267e57600080fd5b505af1158015612692573d6000803e3d6000fd5b505050506040513d60208110156126a857600080fd5b50506000805460408051600080516020612b908339815191528152606060020a600160a060020a03878116919091026013830152825191829003602701822060e160020a637152429d02835260048301523460248301529151919092169263e2a4853a92604480820193602093909283900390910190829087803b15801561272f57600080fd5b505af1158015612743573d6000803e3d6000fd5b505050506040513d602081101561275957600080fd5b50506000805460408051600080516020612b508339815191528152606060020a600160a060020a0387811691909102600f830152825191829003602301822060e160020a637152429d0283526004830152600160248301529151919092169263e2a4853a92604480820193602093909283900390910190829087803b1580156127e157600080fd5b505af11580156127f5573d6000803e3d6000fd5b505050506040513d602081101561280b57600080fd5b505060008054604080517f70726f64756365722e6f757454696d65000000000000000000000000000000008152600160a060020a03868116606060020a02601083015282516024928190038301812060e160020a637152429d02825260048201526407915e5b80928101929092529151919092169263e2a4853a92604480820193602093909283900390910190829087803b1580156128a957600080fd5b505af11580156128bd573d6000803e3d6000fd5b505050506040513d60208110156128d357600080fd5b5050600154604080517fddf80166000000000000000000000000000000000000000000000000000000008152600160a060020a0385811660048301529151919092169163ddf801669160248083019260209291908290030181600087803b15801561293d57600080fd5b505af1158015612951573d6000803e3d6000fd5b505050506040513d602081101561296757600080fd5b5051151560011461297757600080fd5b33600160a060020a03167fc39145bd434b7cf595e248904b19659d40528dda5c35c3b3078c2889c75d283c8a8a8a8a8a8a346040518080602001806020018060200185815260200184810384528b8b82818152602001925080828437909101858103845289815260200190508989808284379091018581038352878152602001905087878082843760405192018290039c50909a5050505050505050505050a250600198975050505050505050565b600154604080517fe80a7eb90000000000000000000000000000000000000000000000000000000081529051606092600160a060020a03169163e80a7eb991600480830192600092919082900301818387803b158015612a8557600080fd5b505af1158015612a99573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f191682016040526020811015612ac257600080fd5b810190808051640100000000811115612ada57600080fd5b82016020810184811115612aed57600080fd5b8151856020820283011164010000000082111715612b0a57600080fd5b509094505050505090565b81810182811015612b2257fe5b92915050565b60008183811515612b3557fe5b049392505050565b600082821115612b4957fe5b50900390560070726f64756365722e7374617475730000000000000000000000000000000000757365722e726f6c65000000000000000000000000000000000000000000000070726f64756365722e766f746557656967687400000000000000000000000000a165627a7a7230582078d7cf7a7e070821b36bd1f7728bdbf70795b5bf24ae277caff0645ae5652f4a0029"
	voteSystemContractCode = "0x60806040526004361061007f5763ffffffff60e060020a600035041663545f4a7181146100845780635b41bc7d146100b85780639be6d404146100cd578063ab91ae80146100ee578063ae2e6f491461011f578063bed7960914610134578063bed9d86114610154578063c792d3591461016b578063dc1e30da14610192575b600080fd5b34801561009057600080fd5b506100a4600480356024810191013561022e565b604080519115158252519081900360200190f35b3480156100c457600080fd5b506100a4610aab565b3480156100d957600080fd5b506100a4600160a060020a0360043516610fb9565b3480156100fa57600080fd5b50610103610fdd565b60408051600160a060020a039092168252519081900360200190f35b34801561012b57600080fd5b506100a4610fec565b6100a460048035600160a060020a031690602480359081019101356119a3565b34801561016057600080fd5b506101696125be565b005b34801561017757600080fd5b50610180612a97565b60408051918252519081900360200190f35b34801561019e57600080fd5b506101b3600160a060020a0360043516612aa0565b6040518085600160a060020a0316600160a060020a0316815260200180602001848152602001838152602001828103825285818151815260200191508051906020019060200280838360005b838110156102175781810151838201526020016101ff565b505050509050019550505050505060405180910390f35b600080546040805160008051602061342e8339815191528152606060020a33026009820152815190819003601d01812060e060020a63bd02d0f502825260048201529051839260609284928392600160a060020a03169163bd02d0f591602480830192602092919082900301818787803b1580156102ab57600080fd5b505af11580156102bf573d6000803e3d6000fd5b505050506040513d60208110156102d557600080fd5b50516002146102e357600080fd5b61031987878080602002602001604051908101604052809392919081815260200183836020028082843750612e19945050505050565b60008054604080516000805160206134ae8339815191528152606060020a3302600b820152815190819003601f01812060e060020a63bd02d0f502825260048201529051600160a060020a039092169263bd02d0f5926024808401936020939083900390910190829087803b15801561039157600080fd5b505af11580156103a5573d6000803e3d6000fd5b505050506040513d60208110156103bb57600080fd5b5051600080546040805160008051602061348e8339815191528152606060020a33026012820152815190819003602601812060e060020a635948f73302825260048201529051939750600160a060020a0390911692635948f7339260248084019391929182900301818387803b15801561043457600080fd5b505af1158015610448573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052602081101561047157600080fd5b81019080805164010000000081111561048957600080fd5b8201602081018481111561049c57600080fd5b81518560208202830111640100000000821117156104b957600080fd5b5050805190965015159250610632915050575060005b8581101561062d578686828181106104e357fe5b6040805160008051602061344e8339815191528152606060020a600160a060020a0360209485029690960135861602601382015281519081900360270181206000805460e060020a63bd02d0f5028452600484018390529351919850929095169463e2a4853a945087936105b1938b93889363bd02d0f59360248084019491938390030190829087803b15801561057957600080fd5b505af115801561058d573d6000803e3d6000fd5b505050506040513d60208110156105a357600080fd5b50519063ffffffff6131fc16565b6040518363ffffffff1660e060020a02815260040180836000191660001916815260200182815260200192505050602060405180830381600087803b1580156105f957600080fd5b505af115801561060d573d6000803e3d6000fd5b505050506040513d602081101561062357600080fd5b50506001016104cf565b6108c0565b5060005b825181101561079657828181518110151561064d57fe5b60209081029091018101516040805160008051602061344e8339815191528152606060020a600160a060020a0393841602601382015281519081900360270181206000805460e060020a63bd02d0f5028452600484018390529351919750929093169363e2a4853a93879361071a938b93889363bd02d0f5936024808501948390030190829087803b1580156106e257600080fd5b505af11580156106f6573d6000803e3d6000fd5b505050506040513d602081101561070c57600080fd5b50519063ffffffff61320f16565b6040518363ffffffff1660e060020a02815260040180836000191660001916815260200182815260200192505050602060405180830381600087803b15801561076257600080fd5b505af1158015610776573d6000803e3d6000fd5b505050506040513d602081101561078c57600080fd5b5050600101610636565b5060005b858110156108c0578686828181106107ae57fe5b6040805160008051602061344e8339815191528152606060020a600160a060020a0360209485029690960135861602601382015281519081900360270181206000805460e060020a63bd02d0f5028452600484018390529351919850929095169463e2a4853a94508793610844938b93889363bd02d0f59360248084019491938390030190829087803b15801561057957600080fd5b6040518363ffffffff1660e060020a02815260040180836000191660001916815260200182815260200192505050602060405180830381600087803b15801561088c57600080fd5b505af11580156108a0573d6000803e3d6000fd5b505050506040513d60208110156108b657600080fd5b505060010161079a565b600080546040805160008051602061346e8339815191528152606060020a3302600b820152815190819003601f01812060e160020a637152429d0282526004820152600160248201529051600160a060020a039092169263e2a4853a926044808401936020939083900390910190829087803b15801561093f57600080fd5b505af1158015610953573d6000803e3d6000fd5b505050506040513d602081101561096957600080fd5b50506000546040805160008051602061348e8339815191528152606060020a3302601282015281519081900360260181207fec672cf60000000000000000000000000000000000000000000000000000000082526004820181815260248301938452604483018b9052600160a060020a039094169363ec672cf69391928c928c92916064018460208502808284378201915050945050505050602060405180830381600087803b158015610a1c57600080fd5b505af1158015610a30573d6000803e3d6000fd5b505050506040513d6020811015610a4657600080fd5b505060408051602080825281810189905233927fd46c1e81ba0ed24eccce499e94541a147c4fa3f6346854d76d70f3b6d401f8db928b928b92829190820190859085028082843760405192018290039550909350505050a25060019695505050505050565b600080546040805160008051602061342e8339815191528152606060020a33026009820152815190819003601d01812060e060020a63bd02d0f5028252600482015290518392839283928392606092600160a060020a039091169163bd02d0f59160248082019260209290919082900301818887803b158015610b2d57600080fd5b505af1158015610b41573d6000803e3d6000fd5b505050506040513d6020811015610b5757600080fd5b5051600214610b6557600080fd5b6040805160008051602061346e8339815191528152606060020a3302600b820152815190819003601f0181206000805460e060020a63bd02d0f5028452600484018390529351919850600160a060020a03939093169263bd02d0f592602480820193602093909283900390910190829087803b158015610be457600080fd5b505af1158015610bf8573d6000803e3d6000fd5b505050506040513d6020811015610c0e57600080fd5b5051600114610c1c57600080fd5b604080516000805160206134ae8339815191528152606060020a3302600b820152815190819003601f0181206000805460e060020a63bd02d0f5028452600484018390529351919750600160a060020a03939093169263bd02d0f592602480820193602093909283900390910190829087803b158015610c9b57600080fd5b505af1158015610caf573d6000803e3d6000fd5b505050506040513d6020811015610cc557600080fd5b50516040805160008051602061348e8339815191528152606060020a3302601282015281519081900360260181206000805460e060020a635948f733028452600484018390529351949750909550600160a060020a039290921692635948f7339260248084019391929182900301818387803b158015610d4457600080fd5b505af1158015610d58573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f191682016040526020811015610d8157600080fd5b810190808051640100000000811115610d9957600080fd5b82016020810184811115610dac57600080fd5b8151856020820283011164010000000082111715610dc957600080fd5b50509291905050509050610de08133856000613221565b60008054604080517f5beff993000000000000000000000000000000000000000000000000000000008152600481018690529051600160a060020a0390921692635beff993926024808401936020939083900390910190829087803b158015610e4857600080fd5b505af1158015610e5c573d6000803e3d6000fd5b505050506040513d6020811015610e7257600080fd5b5050600080546040805160e160020a637152429d02815260048101899052600260248201529051600160a060020a039092169263e2a4853a926044808401936020939083900390910190829087803b158015610ecd57600080fd5b505af1158015610ee1573d6000803e3d6000fd5b505050506040513d6020811015610ef757600080fd5b5050600080546040805160e060020a63e2b202bf028152600481018890529051600160a060020a039092169263e2b202bf926024808401936020939083900390910190829087803b158015610f4b57600080fd5b505af1158015610f5f573d6000803e3d6000fd5b505050506040513d6020811015610f7557600080fd5b505060408051428152905133917f46f83f2216482f0d8839e93d2c2616a5fb914d68342883e58d8842b441bd54d4919081900360200190a260019550505050505090565b60008054600160a060020a03163314610fd157600080fd5b81600160a060020a0316ff5b600054600160a060020a031681565b600080546040805160008051602061342e8339815191528152606060020a33026009820152815190819003601d01812060e060020a63bd02d0f502825260048201529051839283928392606092600160a060020a03169163bd02d0f591602480830192602092919082900301818887803b15801561106957600080fd5b505af115801561107d573d6000803e3d6000fd5b505050506040513d602081101561109357600080fd5b50516003146110a157600080fd5b6040805160008051602061346e8339815191528152606060020a3302600b820152815190819003601f0181206000805460e060020a63bd02d0f5028452600484018390529351919750600160a060020a03939093169263bd02d0f592602480820193602093909283900390910190829087803b15801561112057600080fd5b505af1158015611134573d6000803e3d6000fd5b505050506040513d602081101561114a57600080fd5b505160011461115857600080fd5b60008054604080516000805160206134ae8339815191528152606060020a3302600b820152815190819003601f01812060e060020a63bd02d0f502825260048201529051600160a060020a039092169263bd02d0f5926024808401936020939083900390910190829087803b1580156111d057600080fd5b505af11580156111e4573d6000803e3d6000fd5b505050506040513d60208110156111fa57600080fd5b5051600080546040805160008051602061340e8339815191528152606060020a3302600e82015281519081900360220181207f21f8a72100000000000000000000000000000000000000000000000000000000825260048201529051939650600160a060020a03909116926321f8a72192602480840193602093929083900390910190829087803b15801561128e57600080fd5b505af11580156112a2573d6000803e3d6000fd5b505050506040513d60208110156112b857600080fd5b50519150600160a060020a038216156114fc5760008054604080516000805160206134ae833981519152808252600160a060020a03878116606060020a02600b8085018290528551601f958190038601812094815290810191909152845190819003909301832060e060020a63bd02d0f502845260048401529251929093169363e2a4853a939261136f928992879263bd02d0f5926024808201936020939283900390910190829087803b1580156106e257600080fd5b6040518363ffffffff1660e060020a02815260040180836000191660001916815260200182815260200192505050602060405180830381600087803b1580156113b757600080fd5b505af11580156113cb573d6000803e3d6000fd5b505050506040513d60208110156113e157600080fd5b5050600080546040805160008051602061348e8339815191528152606060020a600160a060020a03878116919091026012830152825191829003602601822060e060020a635948f733028352600483015291519190921692635948f733926024808201939182900301818387803b15801561145b57600080fd5b505af115801561146f573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052602081101561149857600080fd5b8101908080516401000000008111156114b057600080fd5b820160208101848111156114c357600080fd5b81518560208202830111640100000000821117156114e057600080fd5b505092919050505090506114f78183856000613221565b611609565b600080546040805160008051602061348e8339815191528152606060020a33026012820152815190819003602601812060e060020a635948f73302825260048201529051600160a060020a0390921692635948f7339260248084019382900301818387803b15801561156d57600080fd5b505af1158015611581573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f1916820160405260208110156115aa57600080fd5b8101908080516401000000008111156115c257600080fd5b820160208101848111156115d557600080fd5b81518560208202830111640100000000821117156115f257600080fd5b505092919050505090506116098133856000613221565b600080546040805160e160020a637152429d02815260048101889052600260248201529051600160a060020a039092169263e2a4853a926044808401936020939083900390910190829087803b15801561166257600080fd5b505af1158015611676573d6000803e3d6000fd5b505050506040513d602081101561168c57600080fd5b505060008054604080517f766f74652e756e766f746554696d6500000000000000000000000000000000008152606060020a3302600f820152815190819003602301812060e160020a637152429d02825260048201524260248201529051600160a060020a039092169263e2a4853a926044808401936020939083900390910190829087803b15801561171e57600080fd5b505af1158015611732573d6000803e3d6000fd5b505050506040513d602081101561174857600080fd5b5050600080546040805160008051602061348e8339815191528152606060020a3302601282015281519081900360260181207f5beff99300000000000000000000000000000000000000000000000000000000825260048201529051600160a060020a0390921692635beff993926024808401936020939083900390910190829087803b1580156117d857600080fd5b505af11580156117ec573d6000803e3d6000fd5b505050506040513d602081101561180257600080fd5b5050600080546040805160008051602061340e8339815191528152606060020a3302600e82015281519081900360220181207f0e14a37600000000000000000000000000000000000000000000000000000000825260048201529051600160a060020a0390921692630e14a376926024808401936020939083900390910190829087803b15801561189257600080fd5b505af11580156118a6573d6000803e3d6000fd5b505050506040513d60208110156118bc57600080fd5b505060008054604080516000805160206134ae8339815191528152606060020a3302600b820152815190819003601f01812060e060020a63e2b202bf02825260048201529051600160a060020a039092169263e2b202bf926024808401936020939083900390910190829087803b15801561193657600080fd5b505af115801561194a573d6000803e3d6000fd5b505050506040513d602081101561196057600080fd5b505060408051428152905133917f2199fcd2dd4d48edeef57d851b15e6ef618dd40ae1104d8e753602502e33ef1c919081900360200190a2600194505050505090565b6040805160008051602061342e8339815191528152606060020a33026009820152815190819003601d0181206000805460e060020a63bd02d0f5028452600484018390529351909391928492839283926060928492600160a060020a03919091169163bd02d0f591602480830192602092919082900301818787803b158015611a2b57600080fd5b505af1158015611a3f573d6000803e3d6000fd5b505050506040513d6020811015611a5557600080fd5b505115611a6157600080fd5b60008054604080517f73797374656d2e7374616b65466f72566f7465000000000000000000000000008152815190819003601301812060e060020a63bd02d0f502825260048201529051600160a060020a039092169263bd02d0f5926024808401936020939083900390910190829087803b158015611adf57600080fd5b505af1158015611af3573d6000803e3d6000fd5b505050506040513d6020811015611b0957600080fd5b5051945034851115611b1a57600080fd5b600160a060020a038a1615611d6b57600080546040805160008051602061342e8339815191528152606060020a600160a060020a038f8116919091026009830152825191829003601d01822060e060020a63bd02d0f502835260048301529151919092169263bd02d0f592602480820193602093909283900390910190829087803b158015611ba857600080fd5b505af1158015611bbc573d6000803e3d6000fd5b505050506040513d6020811015611bd257600080fd5b5051600214611be057600080fd5b60008054604080517f70726f78792e73746174757300000000000000000000000000000000000000008152600160a060020a038e8116606060020a02600c83015282516020928190038301812060e060020a63bd02d0f50282526004820152925193169363bd02d0f5936024808501949192918390030190829087803b158015611c6957600080fd5b505af1158015611c7d573d6000803e3d6000fd5b505050506040513d6020811015611c9357600080fd5b5051600114611ca157600080fd5b600080546040805160008051602061340e8339815191528152606060020a3302600e82015281519081900360220181207fca446dd90000000000000000000000000000000000000000000000000000000082526004820152600160a060020a038e811660248301529151919092169263ca446dd992604480820193602093909283900390910190829087803b158015611d3957600080fd5b505af1158015611d4d573d6000803e3d6000fd5b505050506040513d6020811015611d6357600080fd5b50611e7f9050565b611da189898080602002602001604051908101604052809392919081815260200183836020028082843750612e19945050505050565b6000546040805160008051602061348e8339815191528152606060020a3302601282015281519081900360260181207fec672cf60000000000000000000000000000000000000000000000000000000082526004820181815260248301938452604483018d9052600160a060020a039094169363ec672cf69391928e928e92916064018460208502808284378201915050945050505050602060405180830381600087803b158015611e5257600080fd5b505af1158015611e66573d6000803e3d6000fd5b505050506040513d6020811015611e7c57600080fd5b50505b600080546040805160e160020a637152429d028152600481018a9052600360248201529051600160a060020a039092169263e2a4853a926044808401936020939083900390910190829087803b158015611ed857600080fd5b505af1158015611eec573d6000803e3d6000fd5b505050506040513d6020811015611f0257600080fd5b505060008054604080517f766f74652e7374616b65640000000000000000000000000000000000000000008152606060020a3302600b820152815190819003601f01812060e160020a637152429d02825260048201523460248201529051600160a060020a039092169263e2a4853a926044808401936020939083900390910190829087803b158015611f9457600080fd5b505af1158015611fa8573d6000803e3d6000fd5b505050506040513d6020811015611fbe57600080fd5b50611fca9050346133d1565b60008054604080516000805160206134ae8339815191528152606060020a3302600b820152815190819003601f01812060e160020a637152429d0282526004820152602481018590529051939750600160a060020a039091169263e2a4853a92604480840193602093929083900390910190829087803b15801561204d57600080fd5b505af1158015612061573d6000803e3d6000fd5b505050506040513d602081101561207757600080fd5b5050600080546040805160008051602061346e8339815191528152606060020a3302600b820152815190819003601f01812060e160020a637152429d0282526004820152600160248201529051600160a060020a039092169263e2a4853a926044808401936020939083900390910190829087803b1580156120f857600080fd5b505af115801561210c573d6000803e3d6000fd5b505050506040513d602081101561212257600080fd5b505060008054604080517f766f74652e756e766f746554696d6500000000000000000000000000000000008152606060020a3302600f820152815190819003602301812060e160020a637152429d02825260048201526407915e5b8060248201529051600160a060020a039092169263e2a4853a926044808401936020939083900390910190829087803b1580156121b957600080fd5b505af11580156121cd573d6000803e3d6000fd5b505050506040513d60208110156121e357600080fd5b5050600160a060020a038a161561241557604080516000805160206134ae8339815191528152606060020a600160a060020a03808e1691909102600b830152825191829003601f0182206000805460e060020a63bd02d0f5028552600485018390529451919750939091169263e2a4853a928792612288928a92879263bd02d0f592602480840193602093929083900390910190829087803b15801561057957600080fd5b6040518363ffffffff1660e060020a02815260040180836000191660001916815260200182815260200192505050602060405180830381600087803b1580156122d057600080fd5b505af11580156122e4573d6000803e3d6000fd5b505050506040513d60208110156122fa57600080fd5b5050600080546040805160008051602061348e8339815191528152606060020a600160a060020a038f8116919091026012830152825191829003602601822060e060020a635948f733028352600483015291519190921692635948f733926024808201939182900301818387803b15801561237457600080fd5b505af1158015612388573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f1916820160405260208110156123b157600080fd5b8101908080516401000000008111156123c957600080fd5b820160208101848111156123dc57600080fd5b81518560208202830111640100000000821117156123f957600080fd5b50509291905050509150612410828b866001613221565b61253f565b5060005b8781101561253f5788888281811061242d57fe5b6040805160008051602061344e8339815191528152606060020a600160a060020a0360209485029690960135861602601382015281519081900360270181206000805460e060020a63bd02d0f5028452600484018390529351919950929095169463e2a4853a945088936124c3938b93889363bd02d0f59360248084019491938390030190829087803b15801561057957600080fd5b6040518363ffffffff1660e060020a02815260040180836000191660001916815260200182815260200192505050602060405180830381600087803b15801561250b57600080fd5b505af115801561251f573d6000803e3d6000fd5b505050506040513d602081101561253557600080fd5b5050600101612419565b89600160a060020a031633600160a060020a03167f5fd2438cc54f76807d5a8071c168927902854cef6c0c22176ded5bbe7174a9fb8b8b34604051808060200183815260200182810382528585828181526020019250602002808284376040519201829003965090945050505050a35060019998505050505050505050565b6040805160008051602061342e8339815191528152606060020a33026009820152815190819003601d0181206000805460e060020a63bd02d0f50284526004840183905293519193909283928392600160a060020a03169163bd02d0f591602480830192602092919082900301818787803b15801561263c57600080fd5b505af1158015612650573d6000803e3d6000fd5b505050506040513d602081101561266657600080fd5b505160031461267457600080fd5b6040805160008051602061346e8339815191528152606060020a3302600b820152815190819003601f0181206000805460e060020a63bd02d0f5028452600484018390529351919650600160a060020a03939093169263bd02d0f592602480820193602093909283900390910190829087803b1580156126f357600080fd5b505af1158015612707573d6000803e3d6000fd5b505050506040513d602081101561271d57600080fd5b505160021461272b57600080fd5b60008054604080517f73797374656d2e6c6f636b54696d65466f725374616b650000000000000000008152815190819003601701812060e060020a63bd02d0f502825260048201529051600160a060020a039092169263bd02d0f5926024808401936020939083900390910190829087803b1580156127a957600080fd5b505af11580156127bd573d6000803e3d6000fd5b505050506040513d60208110156127d357600080fd5b505160008054604080517f766f74652e756e766f746554696d6500000000000000000000000000000000008152606060020a3302600f820152815190819003602301812060e060020a63bd02d0f502825260048201529051939550612869938693600160a060020a039093169263bd02d0f592602480820193602093909283900390910190829087803b15801561057957600080fd5b421161287457600080fd5b60008054604080517f766f74652e7374616b65640000000000000000000000000000000000000000008152606060020a3302600b820152815190819003601f01812060e060020a63bd02d0f502825260048201529051600160a060020a039092169263bd02d0f5926024808401936020939083900390910190829087803b1580156128fe57600080fd5b505af1158015612912573d6000803e3d6000fd5b505050506040513d602081101561292857600080fd5b5051600080546040805160e060020a63e2b202bf028152600481018990529051939450600160a060020a039091169263e2b202bf92602480840193602093929083900390910190829087803b15801561298057600080fd5b505af1158015612994573d6000803e3d6000fd5b505050506040513d60208110156129aa57600080fd5b5050600080546040805160e060020a63e2b202bf028152600481018790529051600160a060020a039092169263e2b202bf926024808401936020939083900390910190829087803b1580156129fe57600080fd5b505af1158015612a12573d6000803e3d6000fd5b505050506040513d6020811015612a2857600080fd5b5050604051339082156108fc029083906000818181858888f19350505050158015612a57573d6000803e3d6000fd5b5060408051828152426020820152815133927fd2a1d21b9fe9c327ee10aa0097ad63335aabc0359e03d12808fc1abd1bf6ffa9928290030190a250505050565b6407915e5b8081565b600080546040805160008051602061340e8339815191528152606060020a600160a060020a0386811691909102600e83015282519182900360220182207f21f8a721000000000000000000000000000000000000000000000000000000008352600483015291516060938593849384938793859384939116916321f8a7219160248082019260209290919082900301818787803b158015612b4057600080fd5b505af1158015612b54573d6000803e3d6000fd5b505050506040513d6020811015612b6a57600080fd5b5051600080546040805160008051602061348e8339815191528152606060020a600160a060020a038f8116919091026012830152825191829003602601822060e060020a635948f73302835260048301529151949850911692635948f7339260248084019391929182900301818387803b158015612be757600080fd5b505af1158015612bfb573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f191682016040526020811015612c2457600080fd5b810190808051640100000000811115612c3c57600080fd5b82016020810184811115612c4f57600080fd5b8151856020820283011164010000000082111715612c6c57600080fd5b505092919050505092506000809054906101000a9004600160a060020a0316600160a060020a031663bd02d0f58a60405180807f766f74652e7374616b6564000000000000000000000000000000000000000000815250600b0182600160a060020a0316600160a060020a0316606060020a02815260140191505060405180910390206040518263ffffffff1660e060020a028152600401808260001916600019168152602001915050602060405180830381600087803b158015612d3057600080fd5b505af1158015612d44573d6000803e3d6000fd5b505050506040513d6020811015612d5a57600080fd5b505160008054604080516000805160206134ae8339815191528152606060020a600160a060020a038f811691909102600b830152825191829003601f01822060e060020a63bd02d0f50283526004830152915194965091169263bd02d0f592602480840193602093929083900390910190829087803b158015612ddc57600080fd5b505af1158015612df0573d6000803e3d6000fd5b505050506040513d6020811015612e0657600080fd5b5051939992985090965091945092505050565b6000601e825111151515612e2c57600080fd5b600080548351600160a060020a039091169163bd02d0f5918591908110612e4f57fe5b60209081029091018101516040805160008051602061342e8339815191528152606060020a600160a060020a03909316929092026009830152805191829003601d01822060e060020a63ffffffff8616028352600483015251602480830193928290030181600087803b158015612ec557600080fd5b505af1158015612ed9573d6000803e3d6000fd5b505050506040513d6020811015612eef57600080fd5b5051600114612efd57600080fd5b600080548351600160a060020a039091169163bd02d0f5918591908110612f2057fe5b6020908102909101810151604080517f70726f64756365722e73746174757300000000000000000000000000000000008152606060020a600160a060020a0390931692909202600f830152805191829003602301822060e060020a63ffffffff8616028352600483015251602480830193928290030181600087803b158015612fa857600080fd5b505af1158015612fbc573d6000803e3d6000fd5b505050506040513d6020811015612fd257600080fd5b5051600114612fe057600080fd5b5060015b81518110156131f8576000548251600160a060020a039091169063bd02d0f59084908490811061301057fe5b60209081029091018101516040805160008051602061342e8339815191528152606060020a600160a060020a03909316929092026009830152805191829003601d01822060e060020a63ffffffff8616028352600483015251602480830193928290030181600087803b15801561308657600080fd5b505af115801561309a573d6000803e3d6000fd5b505050506040513d60208110156130b057600080fd5b50516001146130be57600080fd5b6000548251600160a060020a039091169063bd02d0f5908490849081106130e157fe5b6020908102909101810151604080517f70726f64756365722e73746174757300000000000000000000000000000000008152606060020a600160a060020a0390931692909202600f830152805191829003602301822060e060020a63ffffffff8616028352600483015251602480830193928290030181600087803b15801561316957600080fd5b505af115801561317d573d6000803e3d6000fd5b505050506040513d602081101561319357600080fd5b50516001146131a157600080fd5b81818151811015156131af57fe5b90602001906020020151600160a060020a031682600183038151811015156131d357fe5b60209081029091010151600160a060020a0316106131f057600080fd5b600101612fe4565b5050565b8181018281101561320957fe5b92915050565b60008282111561321b57fe5b50900390565b600080805b86518110156133c857868181518110151561323d57fe5b602090810290910101516040805160008051602061344e8339815191528152606060020a600160a060020a0390931692909202601383015251908190036027019020915083156132e357600080546040805160e060020a63bd02d0f50281526004810186905290516132dc938993600160a060020a03169263bd02d0f59260248083019360209383900390910190829087803b15801561057957600080fd5b925061333b565b600080546040805160e060020a63bd02d0f5028152600481018690529051613338938993600160a060020a03169263bd02d0f59260248083019360209383900390910190829087803b1580156106e257600080fd5b92505b600080546040805160e160020a637152429d02815260048101869052602481018790529051600160a060020a039092169263e2a4853a926044808401936020939083900390910190829087803b15801561339457600080fd5b505af11580156133a8573d6000803e3d6000fd5b505050506040513d60208110156133be57600080fd5b5050600101613226565b50505050505050565b600061320982600163ffffffff6133e416565b60008215156133f557506000613209565b5081810281838281151561340557fe5b041461320957fe00766f74652e766f746550726f7879000000000000000000000000000000000000757365722e726f6c65000000000000000000000000000000000000000000000070726f64756365722e766f746557656967687400000000000000000000000000766f74652e737461747573000000000000000000000000000000000000000000766f74652e766f746550726f6475636572730000000000000000000000000000766f74652e776569676874000000000000000000000000000000000000000000a165627a7a72305820169b8b192dcb5c92834b89cba49a5a4a467298892ec04974c050c1375e31bac10029"

	// System contract abi generated by abigen
	mainSystemContractABI = `[{"constant":true,"inputs":[{"name":"contractName","type":"string"}],"name":"getSystemContract","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getProposal","outputs":[{"name":"","type":"uint256"},{"name":"","type":"bool"},{"name":"","type":"address"},{"name":"","type":"uint256"},{"name":"","type":"address"},{"name":"","type":"bytes32[]"},{"name":"","type":"uint256[]"},{"name":"","type":"uint8"},{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"}]`
	regSystemContractABI  = `[{"constant":true,"inputs":[],"name":"getAllProducersInfo","outputs":[{"name":"","type":"address[]"},{"name":"","type":"uint256[]"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"}]`
	voteSystemContractABI = `[{"constant":true,"inputs":[{"name":"voter","type":"address"}],"name":"getVoteInfo","outputs":[{"name":"","type":"address"},{"name":"","type":"address[]"},{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"}]`

	// Input data for get reg system contract address
	// web3.sha3("getSystemContract(string)")[:4] + abi.encode("system.regContract")
	getRegSystemContractInput   = "79e415950000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001273797374656d2e726567436f6e74726163740000000000000000000000000000"
	getAllProducersInfoMethodID = "1af55073"

	// Contract name
	regContract = "system.regContract"
)

// System contract variables
var (
	// Leave space for precompiled contract
	MainSystemContractAddr = common.BytesToAddress([]byte{100})
	RegSystemContractAddr  = common.BytesToAddress([]byte{101})
	VoteSystemContractAddr = common.BytesToAddress([]byte{102})

	// Main contract variables
	RegContractBoolStorageIndex = common.HexToHash("0x294c67eeb4e9854be6b7482995f3d168c5631fe8e6838cbd520eec4bdee5b238")
	RegContractBoolStorageValue = common.BytesToHash([]byte{1})

	RegContractAddressStorageIndex = common.HexToHash("0x2c3cc3095161e3b91d3f38a624661c5e22214b813a490196a5579ab534744269")
	RegContractAddressStorageValue = common.BytesToHash([]byte{101})

	VoteContractBoolStorageIndex = common.HexToHash("0x217c0c3f40682eea0f663b5fbd7868d2385a8530b037bf00b51c7b65ecb5499b")
	VoteContractBoolStorageValue = common.BytesToHash([]byte{1})

	VoteContractAddressStorageIndex = common.HexToHash("0x1dc4d9c950883ac5624903cc34a28b5df17a64c5129c8e591b2fcf2868607679")
	VoteContractAddressStorageValue = common.BytesToHash([]byte{102})

	// Config variables
	ProposalPeriodStorageIndex     = common.HexToHash("0xa60d09705903017f66ad61d99aaf641e3462e9b3902500e33cd2894f0e18db9b")
	DepositForProducerStorageIndex = common.HexToHash("0x7a06c8971de15237a684de5f15f3debba839b14e3c0463ae590d00223cface88")
	LockTimeForDepositStorageIndex = common.HexToHash("0xf53eb3ed1addc0a7cc10756cd802f479673136ff055bb714fa944101f2811121")
	ProducerSizeStorageIndex       = common.HexToHash("0x3ede241959fceaa722c269e9fa78a72198ca6431ddd02fe6c78d3510adcd2e2a")
	StakeForVoteStorageIndex       = common.HexToHash("0x718b814f1e4c62de9e1c08897b38903d3e2465417d90a0d67b65a284448c0706")
	LockTimeForStakeStorageIndex   = common.HexToHash("0x7042253dbf896808884193cf97c2749eb2f1a3e2867172b79d178e3b3ffdf755")
	MaxProducersStorageIndex       = common.HexToHash("0x8e9ba9d6cd4996caf11b5abc7851069dedf31db342539e4f022d21b298511b5e")

	// Reg contract variables
	SystemContractStorageIndex = common.BytesToHash([]byte{0})
	SystemContractStorageValue = common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000064")

	ProducerOpStorageIndex = common.BytesToHash([]byte{1})
	ProducerOpStorageValue = common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000064")

	// Vote contract variables
	MainContractStorageIndex = common.BytesToHash([]byte{0})
	MainContractStorageValue = common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000064")
)

// Upgradeable system contract for dpos
// Producer/Voters can send tx to system contract for reg, unreg, vote and so on.
func NewHardcodedContractsDpos(config *params.DposConfig) []HardcodedContract {
	if config.DepositForProducer == 0 {
		log.Info("DepositForProducer not set, set to default", "DepositForProducer", params.DepositForProducer)
		config.DepositForProducer = params.DepositForProducer
	}
	if config.LockTimeForDeposit == 0 {
		log.Info("LockTimeForDeposit not set, set to default", "LockTimeForDeposit", params.LockTimeForDeposit)
		config.LockTimeForDeposit = params.LockTimeForDeposit
	}
	if config.LockTimeForStake == 0 {
		log.Info("LockTimeForStake not set, set to default", "LockTimeForStake", params.LockTimeForStake)
		config.LockTimeForStake = params.LockTimeForStake
	}
	if config.ProducerSize < params.MinimumProducerSize {
		log.Info("config producer size is below MinimumProducerSize, set ", "MinimumProducerSize", params.MinimumProducerSize)
		config.ProducerSize = params.ProducerSize
	}
	if config.MaxProducerSize == 0 {
		log.Info("MaxProducersSize not set, set to default", "MaxProducersSize", params.MaxProducersSize)
		config.MaxProducerSize = params.MaxProducersSize
	}
	if config.ProducerSize > params.MaxProducersSize {
		panic("Can't set MaxProducers size below producer size used in dpos")
	}
	if config.ProposalPeriod == 0 {
		log.Info("ProposalPeriod not set, set to default", "ProposalPeriod", params.ProposalPeriod)
		config.ProposalPeriod = params.ProposalPeriod
	}
	if config.StakeForVote == 0 {
		log.Info("StakeForVote not set, set to default", "StakeForVote", params.StakeForVote)
		config.StakeForVote = params.StakeForVote
	}

	return []HardcodedContract{
		NewSystemContract(
			MainSystemContractAddr,
			mainSystemContractCode,
			mainSystemContractABI,
			// Set reg and vote system contract address
			map[common.Hash]common.Hash{
				// Set reg system contract bool; mapping key is : 0x3742e890ccd7b17f07ea3d26ddabc6a24bd77cb109451e8c225eced73747e219
				RegContractBoolStorageIndex: RegContractBoolStorageValue,
				// Set vote system contract bool; mapping key is : 0x46a34feee9b84783782542ca731df2e0a2b7305bf7c1dd556e25d64fd9fa0bd2
				VoteContractBoolStorageIndex: VoteContractBoolStorageValue,
				// Set reg system contract address
				RegContractAddressStorageIndex: RegContractAddressStorageValue,
				// Set vote system contract address
				VoteContractAddressStorageIndex: VoteContractAddressStorageValue,
				ProposalPeriodStorageIndex:      common.BigToHash(new(big.Int).SetUint64(config.ProposalPeriod)),
				StakeForVoteStorageIndex:        common.BigToHash(new(big.Int).SetUint64(config.StakeForVote)),
				LockTimeForStakeStorageIndex:    common.BigToHash(new(big.Int).SetUint64(config.LockTimeForStake)),
				DepositForProducerStorageIndex:  common.BigToHash(new(big.Int).SetUint64(config.DepositForProducer)),
				LockTimeForDepositStorageIndex:  common.BigToHash(new(big.Int).SetUint64(config.LockTimeForDeposit)),
				ProducerSizeStorageIndex:        common.BigToHash(new(big.Int).SetUint64(config.ProducerSize)),
				MaxProducersStorageIndex:        common.BigToHash(new(big.Int).SetUint64(config.MaxProducerSize)),
			},
		),
		NewSystemContract(
			RegSystemContractAddr,
			regSystemContractCode,
			regSystemContractABI,
			map[common.Hash]common.Hash{
				// Set init variables
				SystemContractStorageIndex: SystemContractStorageValue,
				ProducerOpStorageIndex:     ProducerOpStorageValue,
			},
		),
		NewSystemContract(
			VoteSystemContractAddr,
			voteSystemContractCode,
			voteSystemContractABI,
			map[common.Hash]common.Hash{
				// Set init variables
				MainContractStorageIndex: MainContractStorageValue,
			},
		),
	}
}

type HardcodedContract interface {
	GetCode() string
	GetContractAddr() common.Address
	GetStorage() map[common.Hash]common.Hash
}

func NewSystemContract(addr common.Address, code string, abiStr string, storageSet map[common.Hash]common.Hash) *SystemContract {
	// Ignore error
	parsed, _ := abi.JSON(strings.NewReader(abiStr))
	return &SystemContract{
		Addr:       addr,
		Code:       code,
		StorageSet: storageSet,
		ABI:        parsed,
	}
}

// Main dpos upgradeable system contract entry.
// Producer can send tx to this contract for proposing upgrade system
// contract, the storage data will leave on this contract.
type SystemContract struct {
	Addr       common.Address
	Code       string
	StorageSet map[common.Hash]common.Hash
	ABI        abi.ABI
}

func (m *SystemContract) GetCode() string {
	return m.Code
}

func (m *SystemContract) GetContractAddr() common.Address {
	return m.Addr
}

func (m *SystemContract) GetStorage() map[common.Hash]common.Hash {
	return m.StorageSet
}

func (m *SystemContract) GetRegSystemContract(data []byte) common.Address {
	var res = new(common.Address)
	m.ABI.Unpack(res, "getCurrentSystemContractAddress", data)
	return *res
}

// Caller for system contract which can get current reg system contract and get all producers.
type SystemContractCaller struct {
	mainSystemContractABI abi.ABI
	regSystemContractABI  abi.ABI
	voteSystemContractABI abi.ABI
}

func NewSystemContractCaller() *SystemContractCaller {
	// Ignore error
	mainABI, _ := abi.JSON(strings.NewReader(mainSystemContractABI))
	regABI, _ := abi.JSON(strings.NewReader(regSystemContractABI))
	voteABI, _ := abi.JSON(strings.NewReader(voteSystemContractABI))
	return &SystemContractCaller{
		mainABI,
		regABI,
		voteABI,
	}
}

func (s *SystemContractCaller) MainABI() abi.ABI {
	return s.mainSystemContractABI
}

func (s *SystemContractCaller) VoteABI() abi.ABI {
	return s.voteSystemContractABI
}

func (s *SystemContractCaller) GetRegSystemContractCall(header *types.Header) SystemCall {
	copyAddr := MainSystemContractAddr
	return NewCallMsg(&copyAddr, common.Hex2Bytes(getRegSystemContractInput), header.Number.Uint64())
}

func (s *SystemContractCaller) GetRegSystemContractAddress(data []byte) common.Address {
	var res = new(common.Address)
	s.mainSystemContractABI.Unpack(res, "getSystemContract", data)
	return *res
}

func (s *SystemContractCaller) GetAllProducersInfoCall(header *types.Header, contract *common.Address) SystemCall {
	return NewCallMsg(contract, common.Hex2Bytes(getAllProducersInfoMethodID), header.Number.Uint64())
}

func (s *SystemContractCaller) GetAllProducersInfo(data []byte) ([]common.Address, []*big.Int, *big.Int, error) {
	var (
		ret0 = new([]common.Address)
		ret1 = new([]*big.Int)
		ret2 = new(*big.Int)
	)
	out := &[]interface{}{
		ret0,
		ret1,
		ret2,
	}

	err := s.regSystemContractABI.Unpack(out, "getAllProducersInfo", data)
	return *ret0, *ret1, *ret2, err
}

func NewCallMsg(addr *common.Address, data []byte, blockNum uint64) SystemCall {
	return SystemCall{
		ToAddr:    addr,
		DataField: data,
		GasSupply: 50000000,
		AtBlock:   blockNum,
	}
}

type SystemCall struct {
	ToAddr    *common.Address
	DataField []byte
	GasSupply uint64
	AtBlock   uint64
}

func (s SystemCall) From() common.Address { return common.Address{} }
func (s SystemCall) Nonce() uint64        { return 0 }
func (s SystemCall) CheckNonce() bool     { return false }
func (s SystemCall) To() *common.Address  { return s.ToAddr }
func (s SystemCall) GasPrice() *big.Int   { return new(big.Int).SetUint64(0) }
func (s SystemCall) Gas() uint64          { return s.GasSupply }
func (s SystemCall) Value() *big.Int      { return new(big.Int).SetUint64(0) }
func (s SystemCall) Data() []byte         { return s.DataField }
